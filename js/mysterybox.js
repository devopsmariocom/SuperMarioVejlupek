class MysteryBox{constructor(t,i){this.x=t,this.y=i,this.width=40,this.height=40,this.color="#FFD700",this.isCollected=!1,this.pulseDirection=1,this.pulseAmount=0,this.pulseSpeed=.05,this.questionMarkOpacity=1,this.glowSize=10}update(){this.isCollected||(this.pulseAmount+=this.pulseSpeed*this.pulseDirection,this.pulseAmount>1?(this.pulseAmount=1,this.pulseDirection=-1):this.pulseAmount<0&&(this.pulseAmount=0,this.pulseDirection=1),this.questionMarkOpacity=.5+.5*this.pulseAmount)}draw(t,i=0){if(this.isCollected)return;t.save();const e=this.glowSize+5*this.pulseAmount;if(t.shadowColor="rgba(255, 215, 0, 0.9)",t.shadowBlur=e,t.fillStyle=this.color,t.beginPath(),t.moveTo(this.x-i+8,this.y),t.lineTo(this.x-i+this.width-8,this.y),t.arcTo(this.x-i+this.width,this.y,this.x-i+this.width,this.y+8,8),t.lineTo(this.x-i+this.width,this.y+this.height-8),t.arcTo(this.x-i+this.width,this.y+this.height,this.x-i+this.width-8,this.y+this.height,8),t.lineTo(this.x-i+8,this.y+this.height),t.arcTo(this.x-i,this.y+this.height,this.x-i,this.y+this.height-8,8),t.lineTo(this.x-i,this.y+8),t.arcTo(this.x-i,this.y,this.x-i+8,this.y,8),t.closePath(),t.fill(),t.strokeStyle="rgba(139, 69, 19, 0.8)",t.lineWidth=2,t.stroke(),t.fillStyle=`rgba(0, 0, 0, ${this.questionMarkOpacity})`,t.font="bold 24px Arial",t.textAlign="center",t.textBaseline="middle",t.fillText("?",this.x-i+this.width/2,this.y+this.height/2),Math.random()<.1){t.fillStyle="white";const e=3+2*Math.random(),s=this.x-i+Math.random()*this.width,o=this.y+Math.random()*this.height;t.beginPath(),t.arc(s,o,e,0,2*Math.PI),t.fill()}t.restore()}checkCollision(t){return!this.isCollected&&Utils.checkCollision(this,t)}activate(t){this.isCollected=!0;const i=[{type:"hat",name:"Klobouk",description:"Stylový klobouk!",duration:15e3,apply:t=>{t.hat=!0,t.hatColor="#333333"},remove:t=>{t.hat=!1}},{type:"suit",name:"Smoking",description:"Elegantní smoking!",duration:15e3,apply:t=>{t.suit=!0,t.color="#000080"},remove:t=>{t.suit=!1,t.color="#FF0000"}},{type:"invincibility",name:"Nesmrtelnost",description:"Dočasná nesmrtelnost!",duration:1e4,apply:t=>{t.isInvincible=!0},remove:t=>{t.isInvincible=!1}},{type:"cloud",name:"Létající obláček",description:"Létající obláček!",duration:8e3,apply:t=>{t.hasCloud=!0,t.gravity=.2,t.jumpForce=10},remove:t=>{t.hasCloud=!1,t.gravity=.8,t.jumpForce=15}},{type:"speed",name:"Rychlost",description:"Super rychlost!",duration:12e3,apply:t=>{t.speedBoost=!0,t.speed*=1.7},remove:t=>{t.speedBoost=!1,t.speed/=1.7}},{type:"poop",name:"Hovínko",description:"Fuj, hovínko!",duration:8e3,apply:t=>{t.pooped=!0,t.color="#8B4513",t.speed*=.7},remove:t=>{t.pooped=!1,t.color="#FF0000",t.speed/=.7}},{type:"glitch",name:"Glitch",description:"Glitch v matrixu!",duration:7e3,apply:t=>{t.glitching=!0},remove:t=>{t.glitching=!1}},{type:"reverse",name:"Obrácené ovládání",description:"Obrácené ovládání!",duration:1e4,apply:t=>{t.reversedControls=!0},remove:t=>{t.reversedControls=!1}},{type:"shrink",name:"Zmenšení",description:"Zmenšení!",duration:9e3,apply:t=>{t.shrunk=!0,t.width/=2,t.height/=2,t.jumpForce*=.8},remove:t=>{t.shrunk=!1,t.width*=2,t.height*=2,t.jumpForce/=.8}}],e=i[Math.floor(Math.random()*i.length)];return e.apply(t),setTimeout((()=>{e.remove(t)}),e.duration),e}}const MysteryBoxGenerator={generateMysteryBoxes:function(t,i=5){const e=[],s=t.filter((t=>t.width>=50&&t.x>100&&t.x<4e3));console.log("Suitable platforms for mystery boxes:",s.length);const o=[...s].sort((()=>.5-Math.random()));for(let t=0;t<Math.min(i,o.length);t++){const i=o[t],s=i.x+Math.min(50,i.width/4)+Utils.randomInt(0,Math.max(0,i.width-100)),h=i.y-80,n=new MysteryBox(s,h);e.push(n)}const h=t.find((t=>t.y>=550&&t.x<100));if(h){const t=Utils.randomInt(2,3);for(let i=0;i<t;i++){const t=200+80*i,s=h.y-150,o=new MysteryBox(t,s);e.push(o)}}return e}};